{% extends "base.html" %}
{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∞–π—Ç–∞{% endblock %}
{% block content %}
<h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∞–π—Ç–∞</h2>

<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
<form method="get">
    <label>–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:</label>
    <input type="date" name="start_date" value="{{ start_date }}">

    <label>–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞:</label>
    <input type="date" name="end_date" value="{{ end_date }}">

    <button type="submit">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
</form>

<hr>

<div class="stats-grid">
    <div class="stat-card">
        <h4>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h4>
        <p>{{ total_users }}</p>
    </div>
    <div class="stat-card">
        <h4>–ù–æ–≤–æ—Å—Ç–∏</h4>
        <p>{{ total_news }}</p>
    </div>
    <div class="stat-card">
        <h4>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
        <p>{{ total_bookings }}</p>
    </div>
    <div class="stat-card">
        <h4>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞</h4>
        <p>{{ total_revenue }} ‚ÇΩ</p>
    </div>
    {% if popular_booking_date %}
    <div class="stat-card">
        <h4>–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –¥–µ–Ω—å</h4>
        <p>{{ popular_booking_date.date }} ({{ popular_booking_date.count }})</p>
    </div>
    {% endif %}
</div>

<!-- –î–∏–∞–≥—Ä–∞–º–º–∞ -->
<canvas id="revenueChart" width="800" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('revenueChart').getContext('2d');

    const labels = [
        {% for item in revenue_data %}
            "{{ item.day }}",
        {% endfor %}
    ];

    const data = {
        labels: labels,
        datasets: [{
            label: '–í—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å',
            backgroundColor: 'rgba(54, 162, 235, 0.5)',
            borderColor: 'rgba(54, 162, 235, 1)',
            data: [
                {% for item in revenue_data %}
                    {{ item.total|default:0 }},
                {% endfor %}
            ],
            fill: true,
        }]
    };

    new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            scales: {
                y: { beginAtZero: true }
            },
            plugins: {
                legend: { display: true },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.parsed.y + ' ‚ÇΩ';
                        }
                    }
                }
            }
        }
    });
</script>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.stat-card {
    background: #f9f9f9;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
</style>

{% endblock %}